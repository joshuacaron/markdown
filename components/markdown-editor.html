<polymer-element name="markdown-editor" layout vertical attributes="markdown focus">
  <!-- outermost template defines the element's shadow DOM -->
  <template>
    <style>
  #wrapper {
    height:100%;
    width:100%;
  }
  #preview {
    padding: 0 15px;
    margin:0;
    overflow-x:hidden;
    overflow-y:auto;
    font-family:"Open Sans";
    font-size:16px;
    color:#212121;
    cursor:pointer;
  }
  #markdown {
    outline:none;
    border:none;
    border-right:solid 1px #e0e0e0;
    resize:none;
    overflow-y:auto;
    overflow-x:hidden;
    padding:15px;
    font-family:"Open Sans";
    font-size:16px;
    color:#212121;
  }
  </style>
  <div id="wrapper" layout horizontal flex>
    <textarea id="markdown" value="{{markdown}}" autofocus flex></textarea>
    <div id="preview" flex></div>
    </div>
  </template>
  <script>
      Polymer('markdown-editor', {
      markdown:"",
      eventDelegates:{
        focus:"onFocus"
      },
      onFocus:function(){
        editor = this;
      },
      focus:function(){
        this.$.markdown.focus();
        console.log("focusing");
      },
      markdownChanged:function(){
        this.injectBoundHTML(markdown.toHTML(this.markdown),this.$.preview);
        cursor = this.$.markdown.selectionStart;
        n = this.markdown.length;
        secondLast = this.markdown.slice(n-2,n-1);
        if (cursor==n && secondLast=="\n"){
          $(this.$.markdown).scrollTop(this.$.markdown.scrollHeight);
          $(this.$.preview).scrollTop(this.$.preview.scrollHeight);
        };
      },
      ready:function(){
        editor = this;
        this.$.preview.addEventListener("click",function(){
          var copyFrom = $('<textarea/>');
          copyFrom.text(markdown.toHTML(editor.markdown));
          $('body').append(copyFrom);
          copyFrom.select();
          document.execCommand('copy');
          copyFrom.remove();
          document.querySelector("#toast").show();
        })
        this.$.markdown.addEventListener("scroll",function(){
          wrapperHeight = editor.$.markdown.style.height;
          innerHeight = editor.$.markdown.scrollHeight;
          previewHeight = editor.$.preview.scrollHeight;
          ratio = (innerHeight - wrapperHeight)/(previewHeight - wrapperHeight);
          previewPosition = $(editor.$.markdown).scrollTop() * ratio;
          $(editor.$.preview).scrollTop(previewPosition);
        })
      }
    });
</script>
</polymer-element>